<div class="row mx-1 mx-md-4   ">
    <div class="card mt-2 py-2 header-card" style="border: none;">
        <div class="card-body">
            <h5 class="card-title"><i class="fa-regular fa-pen-to-square me-2"></i> Reports Management </h5>
            <p class="card-text" style="font-size: 13px;">Here you can manage Reports Details </p>
            <a class="btn btn-secondary btn-sm " (click)="clickonBack()"><i class="fa-regular fa-square-caret-left"></i>
                Go Back</a>
            <a class="btn btn-secondary btn-sm ms-md-4" (click)="addNewTestModal()" data-bs-toggle="modal"
                data-bs-target="#addTestModal"><i class="fa-solid fa-plus"></i> Add New Report</a>
            <a class="btn btn-secondary btn-sm ms-md-4"><i class="fa-regular fa-file-pdf"></i> Export As PDF</a>
        </div>
    </div>
</div>

<div class="row mx-md-2  mt-4">
    <div class="patientTableDiv pt-2">
        <div class="row mx-1 py-2">
            <div class="col-xl-8 col-md-6">
                <h6>Test List</h6>
            </div>
            <div class="col-xl-4 col-md-6">
                <div class="form-group input-group-sm ps-md-4">
                    <div class="input-group  input-group-sm">
                        <input type="text" class="form-control" minlength="3" placeholder="Enter Test Name" required>
                        <button type="button" class="btn btn-secondary btn-sm"><i
                                class="fa-solid fa-magnifying-glass"></i></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="PatientTable">
            <table class="table table-hover table-sm table-bordered">
                <thead>
                    <tr>
                        <th scope="col">Test Id</th>
                        <th scope="col">Test Name</th>
                        <th scope="col">Test Code</th>
                        <th scope="col">Gender</th>
                        <th scope="col">Department</th>
                        <th scope="col">Creation Date</th>
                        <th scope="col">Modified Date</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let test of testMasterList | paginate: { itemsPerPage: 9, currentPage: p }; index as i">
                        <td scope="row">{{test.testId}}</td>
                        <td class="testName" (click)="viewTest(test.testId)" data-bs-toggle="modal"
                            data-bs-target="#viewTestModal">{{test.testName}}</td>
                        <td>{{test.testCode}}</td>
                        <td>{{test.testGender}}</td>
                        <td>{{test.department}}</td>
                        <td>{{test.addedDate | date:'medium'}}</td>
                        <td>{{test.modifiedDate | date:'medium'}}</td>
                        <td><a (click)="openTest(test.testId)" data-bs-toggle="modal" data-bs-target="#addTestModal"
                                style="color: green; cursor: pointer;">Edit test</a> |
                            <a (click)="setTestId(test.testId)" data-bs-toggle="modal" data-bs-target="#OptionModal"
                                style="color: rgb(255, 0, 0); cursor: pointer;">Delete</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <pagination-controls (pageChange)="p = $event" class="pull-right"
                style="font-size: small;"></pagination-controls>
        </div>
    </div>
</div>

<!-- view test modal -->
<div class="modal fade" id="viewTestModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
    aria-labelledby="viewTestModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl modal-fullscreen-lg-down">
        <div class="modal-content">
            <div class="modal-header ">
                <h5 class="modal-title ms-0" id="viewTestModalLabel">Test Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body reports-modalbody mb-0 pb-0 ">

                <div class="container-fluid m-0 p-0">
                    <div class="row my-2 justify-content-center">
                        <div class="col-3">
                            <div class="form-group input-group-sm">
                                <label for="">Department </label>
                            </div>
                            <div class="form-group input-group input-group-sm">
                                <select class="form-select" [(ngModel)]="testMaster.department" name="department"
                                    #department="ngModel" minlength="2" disabled>
                                    <option value="HAEMATOLOGY">HAEMATOLOGY</option>
                                    <option value="RADIOLOGY">RADIOLOGY</option>
                                    <option value="HISTOPATHOLOGY">HISTOPATHOLOGY</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group input-group-sm">
                                <label for="">Test Name </label>
                                <div class="input-group flex-nowrap input-group-sm">
                                    <input type="text" class="form-control" minlength="3"
                                        [(ngModel)]="testMaster.testName" name="testName" #testName="ngModel"
                                        minlength="2" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group input-group-sm">
                                <label for="">Gender </label>
                            </div>
                            <div class="form-group input-group input-group-sm">
                                <select class="form-select" [(ngModel)]="testMaster.testGender" name="testGender"
                                    #testGender="ngModel" minlength="1" disabled>
                                    <option class="form-control" value="M">Male</option>
                                    <option class="form-control" value="F">Female</option>
                                    <option class="form-control" value="B">Both</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group input-group-sm">
                                <label for="">Test Code </label>
                                <input type="text" class="form-control" [(ngModel)]="testMaster.testCode"
                                    name="testCode" #testCode="ngModel" minlength="2" disabled>
                            </div>
                        </div>
                    </div>
                    <div class="row my-2 justify-content-center">
                        <div class="col-3">
                            <div class="form-group input-group-sm">
                                <label for="">Test Cost </label>
                                <input type="number" class="form-control" name="userAge"
                                    [(ngModel)]="testMaster.testCost" name="testCost" #testCost="ngModel" minlength="2"
                                    disabled>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group input-group-sm">
                                <label for="">Sample Type </label>
                            </div>
                            <div class="form-group input-group input-group-sm">
                                <select class="form-select" [(ngModel)]="testMaster.sampleType" disabled>
                                    <option class="form-control" value="Serum">Serum</option>
                                    <option class="form-control" value="Heparinised Blood">Heparinised Blood
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group input-group-sm">
                                <label for="">Test Type </label>
                            </div>
                            <div class="form-group input-group input-group-sm">
                                <select class="form-select" [(ngModel)]="testMaster.testType" name="testTyper"
                                    #testType="ngModel" disabled>
                                    <option class="form-control" value="Table">Table</option>
                                    <option class="form-control" value="Text">Text</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group input-group-sm">
                                <label for="">Remark </label>
                                <input type="text" class="form-control" name="remark" [(ngModel)]="testMaster.remark"
                                    name="remark" #remark="ngModel" disabled>
                            </div>
                        </div>
                    </div>
                    <!-- Reports details start -->
                    <div class="row mt-4 justify-content-center">
                        <div class="col-4 report-data-field">
                            <form #fieldform="ngForm">
                                <div class="col-12">
                                    <div class="form-group input-group-sm">
                                        <label for="">Type </label>
                                    </div>
                                    <div class="form-group input-group input-group-sm">
                                        <select class="form-select" [(ngModel)]="field_type" name="field_type" disabled>
                                            <option *ngIf="testMaster.testType =='Table'" value="Single Field">Single
                                                Field
                                            </option>
                                            <option *ngIf="testMaster.testType=='Table'" value="Title Field">Title Field
                                            </option>
                                            <option *ngIf="testMaster.testType=='Table'" value="Sub Field">Sub Field
                                            </option>
                                            <option *ngIf="testMaster.testType=='Text'" value="Text Editor">Text Editor
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div
                                    *ngIf="(field_type=='Single Field' || field_type=='Sub Field') && testMaster.testType=='Table'">
                                    <div *ngIf="field_type=='Sub Field';">
                                        <div class="col-12">
                                            <div class="form-group input-group-sm">
                                                <label for="">Title Field </label>
                                            </div>
                                            <div class="form-group input-group input-group-sm">
                                                <select class="form-select" [(ngModel)]="title_field_of_subfield"
                                                    name="title_field_of_subfield" [disabled]="modifyRow" required>
                                                    <option value="">Select</option>
                                                    <option *ngFor="let item of title_field_list" value="{{item}}">
                                                        {{item}}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group input-group-sm">
                                            <label for="">Name </label>
                                            <input type="text" class="form-control" [(ngModel)]="field_name"
                                                name="field_name" disabled>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group input-group-sm">
                                            <label for="">Data Type </label>
                                        </div>
                                        <div class="form-group input-group input-group-sm">
                                            <select class="form-select" [(ngModel)]="data_type" name="data_type"
                                                disabled>
                                                <option value="text">text</option>
                                                <option value="numeric" selected>numeric</option>
                                                <option value="numeric unbound">numeric unbound</option>
                                                <option value="multiple ranges">multiple ranges</option>
                                                <option value="custom">custom</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- numeric Fiels start -->
                                    <div *ngIf="data_type=='numeric';">
                                        <div class="col-12">
                                            <div class="form-group input-group-sm">
                                                <label for="">Unit </label>
                                                <input type="text" class="form-control" name="unit" [(ngModel)]="unit"
                                                    disabled>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">Range </label>
                                                        <input type="number" class="form-control" name="range"
                                                            [(ngModel)]="range_from" disabled>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">To </label>
                                                        <input type="number" class="form-control" name="range_to"
                                                            [(ngModel)]="range_to" disabled>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- numeric Fiels End -->
                                    <!-- text Fiels start -->
                                    <div *ngIf="(data_type=='text' || data_type=='multiple ranges');">
                                        <div class="col-12">
                                            <div class="form-group input-group-sm">
                                                <label for="">Unit </label>
                                                <input type="text" class="form-control" name="unit" [(ngModel)]="unit"
                                                    disabled>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-group input-group-sm">
                                                <label for="">Range </label>
                                                <textarea class="form-control" rows="2" placeholder="enter range"
                                                    [(ngModel)]="range_from" name="range" disabled></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- text Fiels end -->

                                    <!-- numeric unbound Fiels start -->
                                    <div *ngIf="data_type=='numeric unbound';">
                                        <div class="col-12">
                                            <div class="form-group input-group-sm">
                                                <label for="">Unit </label>
                                                <input type="text" class="form-control" name="unit" [(ngModel)]="unit"
                                                    disabled>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">Select Operation </label>
                                                    </div>
                                                    <div class="form-group input-group input-group-sm">
                                                        <select class="form-select" [(ngModel)]="opertaion"
                                                            name="opertaion" disabled>
                                                            <option value="less than equal to">less than equal to
                                                            </option>
                                                            <option value="less than">less than</option>
                                                            <option value="greater than equal to">greater than equal to
                                                            </option>
                                                            <option value="greater than">greater than</option>
                                                            <option value="equal to">equal to</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">Value </label>
                                                        <input type="number" class="form-control" name="operation_value"
                                                            [(ngModel)]="operation_value" disabled>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- numeric unbound Fiels End -->

                                    <!-- custom Fiels start -->
                                    <div *ngIf="data_type=='custom';">
                                        <div class="col-12">
                                            <div class="row">
                                                <div *ngIf="selected_options.length != 0" class="col-12 mt-2">
                                                    <table class="table table-sm table-bordered">
                                                        <tbody>
                                                            <tr>
                                                                <td *ngFor="let item of selected_options index as i">
                                                                    {{item}}
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col-12">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">Units </label>
                                                        <input type="text" class="form-control" name="unit"
                                                            [(ngModel)]="unit" disabled>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="form-group input-group-sm">
                                                        <label for="exampleFormControlTextarea1"
                                                            class="form-label">Range</label>
                                                        <textarea class="form-control" rows="2" disabled
                                                            [(ngModel)]="range_from" name="range"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- custom Fiels End -->
                                    <div class="form-check mt-2" *ngIf="data_type=='numeric';">
                                        <div class="row">
                                            <div class="col-6 p-0">
                                                <label class="ms-0">Apply Formula</label>
                                            </div>

                                            <div class="col-3 form-check">
                                                <input class="form-check-input" type="radio" name="CheckBox"
                                                    id="flexCheckDefault1" (click)="applyFormulaYes()"
                                                    [checked]="apply_formula" disabled>
                                                <label class="form-check-label" for="flexCheckDefault1">
                                                    Yes
                                                </label>
                                            </div>
                                            <div class="col-3 form-check">
                                                <input class="form-check-input" type="radio" name="CheckBox"
                                                    id="flexCheckDefault2" (click)="applyFormulaNo()"
                                                    [checked]="!apply_formula" disabled>
                                                <label class="form-check-label" for="flexCheckDefault2">
                                                    No
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div *ngIf="apply_formula==true;">
                                        <div class="col-12 mt-2">
                                            <div class="form-group input-group-sm">
                                                <textarea class="form-control" rows="2" placeholder="Add Formula"
                                                    [(ngModel)]="formula" name="formula" required disabled></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Title Field start -->
                                <div *ngIf="field_type=='Title Field' && testMaster.testType=='Table'">
                                    <div class="col-12 mt-2">
                                        <div class="form-group input-group-sm">
                                            <label for="">Title Field *</label>
                                            <input type="text" class="form-control" name="title_field"
                                                [(ngModel)]="title_field" placeholder="Enter Title Field" disabled>
                                        </div>
                                    </div>
                                </div>
                                <!-- Title Field end -->
                            </form>
                        </div>
                        <div class="col-8">
                            <div *ngIf="testMaster.testType=='Text'" style="height: 54vh;">
                                <angular-editor [placeholder]="'Enter text here...'" [(ngModel)]="textContent"
                                    [config]="editorConfig" disabled></angular-editor>
                                <iframe frameborder="0">
                                    <div id="pdfContent" class="textContentDiv" style="width: 570px;" #pdfContent>
                                        <div class="textContentDiv" [innerHTML]="textContent"></div>
                                    </div>
                                </iframe>
                            </div>
                            <div *ngIf="field_type!='Text Editor' && testMaster.testType=='Table'"
                                style="height: 54vh;  width: 100%;">
                                <table class="table table-hover table-bordered">
                                    <thead class="table-light" style="position: sticky; top: 0; z-index: 1;">
                                        <tr>
                                            <th scope="col">Select</th>
                                            <th scope="col">#</th>
                                            <th scope="col">+</th>
                                            <th scope="col">Field Name</th>
                                            <th scope="col">Sub Field</th>
                                            <th scope="col">Data Type</th>
                                            <th scope="col">Unit</th>
                                            <th scope="col">Range</th>
                                            <th scope="col">Formula</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let item of testMaster.testTableDataDTOList index as i">
                                            <th><input class="form-check-input" type="checkbox"
                                                    name="{{item.field_name}}" id="{{item.field_name}}"
                                                    [checked]="selected === i"
                                                    (change)="onClickTestField($event,item,i)"></th>
                                            <th>{{i+1}}</th>
                                            <th (click)="openSUbFieldTable(i)" style="cursor: pointer;"
                                                data-bs-toggle="tooltip" data-bs-placement="bottom">
                                                <span *ngIf="isRowClickable(i)">
                                                    <span *ngIf="expanded[i]" title="Collapse subfield Table">-</span>
                                                    <span *ngIf="!expanded[i]" title="Expand subfield Table">+</span>
                                                </span>
                                            </th>
                                            <td style="cursor: pointer;">{{item.field_name}}</td>
                                            <td>{{item.sub_field}}</td>
                                            <td>{{item.data_type}}</td>
                                            <td>{{item.unit}}</td>
                                            <td>{{item.range_from}}-{{item.range_to}}</td>
                                            <th><input *ngIf="item.apply_formula == true" class="form-check-input"
                                                    type="checkbox" name="check+i" id="check+i" checked disabled>
                                                <input *ngIf="item.apply_formula == false" class="form-check-input"
                                                    type="checkbox" name="check+i" id="check+i" disabled>
                                            </th>
                                        </tr>
                                    </tbody>
                                    <br>
                                    <tbody *ngIf="subfieldTableFlag" class="table-secondary">
                                        <tr *ngFor="let item of subFieldDataList index as i">
                                            <th><input class="form-check-input" type="checkbox"
                                                    name="{{item.sub_field}}" id="{{item.sub_field}}"
                                                    [checked]="subFieldSelected === i"
                                                    (change)="onClickTestSubField($event,item,i)"></th>
                                            <th>{{i+1}}</th>
                                            <th></th>
                                            <td style="cursor: pointer;">{{item.field_name}}</td>
                                            <td>{{item.sub_field}}</td>
                                            <td>{{item.data_type}}</td>
                                            <td>{{item.unit}}</td>
                                            <td>{{item.range_from}}-{{item.range_to}}</td>
                                            <th><input *ngIf="item.apply_formula == 'Y'" class="form-check-input"
                                                    type="checkbox" name="check+i" id="check+i" checked disabled>
                                                <input *ngIf="item.apply_formula == 'N'" class="form-check-input"
                                                    type="checkbox" name="check+i" id="check+i" disabled>
                                            </th>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-secondary btn-sm" data-bs-target="#viewReportPdf1"
                    data-bs-toggle="modal" data-bs-dismiss="modal" (click)=" makePdf()">View Report</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="addTestModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
    aria-labelledby="addTestModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl modal-fullscreen-lg-down">
        <div class="modal-content">
            <div class="modal-header ">
                <h5 class="modal-title ms-0" id="addTestModalLabel">{{modalTitle}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body reports-modalbody mb-0 pb-0 ">

                <div class="container-fluid m-0 p-0">
                    <form #f="ngForm">
                        <div class="row my-2 justify-content-center">
                            <div class="col-3">
                                <div class="form-group input-group-sm">
                                    <label for="">Department </label>
                                </div>
                                <div class="form-group input-group input-group-sm">
                                    <select class="form-select" [(ngModel)]="testMaster.department" name="department"
                                        #department="ngModel" minlength="2"
                                        [ngClass]="{ 'is-valid': department.touched && !department.errors,'is-invalid': department.touched && department.errors }"
                                        required>
                                        <option selected value="">Select Department</option>
                                        <option value="HAEMATOLOGY">HAEMATOLOGY</option>
                                        <option value="RADIOLOGY">RADIOLOGY</option>
                                        <option value="HISTOPATHOLOGY">HISTOPATHOLOGY</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group input-group-sm">
                                    <label for="">Test Name </label>
                                    <div class="input-group flex-nowrap input-group-sm">
                                        <input type="text" class="form-control" minlength="3"
                                            [(ngModel)]="testMaster.testName" placeholder="Enter Test Name"
                                            name="testName" #testName="ngModel" minlength="2"
                                            [ngClass]="{ 'is-valid': testName.touched && !testName.errors,'is-invalid': testName.touched && testName.errors }"
                                            required>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group input-group-sm">
                                    <label for="">Gender </label>
                                </div>
                                <div class="form-group input-group input-group-sm">
                                    <select class="form-select" [(ngModel)]="testMaster.testGender" name="testGender"
                                        #testGender="ngModel" minlength="1"
                                        [ngClass]="{ 'is-valid': testGender.touched && !testGender.errors,'is-invalid': testGender.touched && testGender.errors }"
                                        required>
                                        <option class="form-control" selected value="">Select</option>
                                        <option class="form-control" value="M">Male</option>
                                        <option class="form-control" value="F">Female</option>
                                        <option class="form-control" value="B">Both</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group input-group-sm">
                                    <label for="">Test Code </label>
                                    <input type="text" class="form-control" [(ngModel)]="testMaster.testCode"
                                        placeholder="Enter Test Code" name="testCode" #testCode="ngModel" minlength="2"
                                        [ngClass]="{ 'is-valid': testCode.touched && !testCode.errors,'is-invalid': testCode.touched && testCode.errors }"
                                        required>
                                </div>
                            </div>
                        </div>
                        <div class="row my-2 justify-content-center">
                            <div class="col-3">
                                <div class="form-group input-group-sm">
                                    <label for="">Test Cost </label>
                                    <input type="number" class="form-control" name="userAge"
                                        [(ngModel)]="testMaster.testCost" placeholder="Enter Cost" name="testCost"
                                        #testCost="ngModel" minlength="2"
                                        [ngClass]="{ 'is-valid': testCost.touched && !testCost.errors,'is-invalid': testCost.touched && testCost.errors }"
                                        required>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group input-group-sm">
                                    <label for="">Sample Type </label>
                                </div>
                                <div class="form-group input-group input-group-sm">
                                    <select class="form-select" [(ngModel)]="testMaster.sampleType">
                                        <option class="form-control" selected value="">Select</option>
                                        <option class="form-control" value="Serum">Serum</option>
                                        <option class="form-control" value="Heparinised Blood">Heparinised Blood
                                        </option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group input-group-sm">
                                    <label for="">Test Type </label>
                                </div>
                                <div class="form-group input-group input-group-sm">
                                    <select class="form-select" [(ngModel)]="testMaster.testType" name="testTyper"
                                        #testType="ngModel" required>
                                        <option class="form-control" selected value="">Select test type</option>
                                        <option class="form-control" value="Table">Table</option>
                                        <option class="form-control" value="Text">Text</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group input-group-sm">
                                    <label for="">Remark </label>
                                    <input type="text" class="form-control" name="remark"
                                        [(ngModel)]="testMaster.remark" name="remark" #remark="ngModel"
                                        placeholder="Enter Remark">
                                </div>
                            </div>
                        </div>
                    </form>
                    <!-- Reports details start -->
                    <div class="row mt-4 justify-content-center">
                        <div class="col-4 report-data-field">

                            <div class="col-12">
                                <div class="form-group input-group-sm">
                                    <label for="">Type </label>
                                </div>
                                <div class="form-group input-group input-group-sm">
                                    <select class="form-select" [(ngModel)]="field_type" name="field_type"
                                        [disabled]="modifyRow">
                                        <option *ngIf="testMaster.testType =='Table'" value="Single Field">Single
                                            Field
                                        </option>
                                        <option *ngIf="testMaster.testType=='Table'" value="Title Field">Title Field
                                        </option>
                                        <option *ngIf="testMaster.testType=='Table'" value="Sub Field">Sub Field
                                        </option>
                                        <option *ngIf="testMaster.testType=='Text'" value="Text Editor">Text Editor
                                        </option>
                                    </select>
                                </div>
                            </div>

                            <div
                                *ngIf="(field_type=='Single Field' || field_type=='Sub Field') && testMaster.testType=='Table'">
                                <form #fieldform="ngForm">
                                    <div *ngIf="field_type=='Sub Field';">
                                        <div class="col-12">
                                            <div class="form-group input-group-sm">
                                                <label for="">Title Field *</label>
                                            </div>
                                            <div class="form-group input-group input-group-sm">
                                                <select class="form-select" [(ngModel)]="title_field_of_subfield"
                                                    name="title_field_of_subfield" [disabled]="modifyRow" required>
                                                    <option value="">Select</option>
                                                    <option *ngFor="let item of title_field_list" value="{{item}}">
                                                        {{item}}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group input-group-sm">
                                            <label for="">Field Name *</label>
                                            <input type="text" class="form-control" [(ngModel)]="field_name"
                                                name="field_name" placeholder="Enter Name" required>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group input-group-sm">
                                            <label for="">Data Type *</label>
                                        </div>
                                        <div class="form-group input-group input-group-sm">
                                            <select class="form-select" [(ngModel)]="data_type" name="data_type">
                                                <option value="text">text</option>
                                                <option value="numeric" selected>numeric</option>
                                                <option value="numeric unbound">numeric unbound</option>
                                                <option value="multiple ranges">multiple ranges</option>
                                                <option value="custom">custom</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- numeric Fiels start -->
                                    <div *ngIf="data_type=='numeric';">
                                        <div class="col-12">
                                            <div class="form-group input-group-sm">
                                                <label for="">Unit </label>
                                                <input type="text" class="form-control" name="unit" [(ngModel)]="unit"
                                                    placeholder="Enter Unit">
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">Range </label>
                                                        <input type="number" class="form-control" name="range"
                                                            [(ngModel)]="range_from" placeholder="Minimum">
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">To </label>
                                                        <input type="number" class="form-control" name="range_to"
                                                            [(ngModel)]="range_to" placeholder="Maximum">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- numeric Fiels End -->
                                    <!-- text Fiels start -->
                                    <div *ngIf="(data_type=='text' || data_type=='multiple ranges');">
                                        <div class="col-12">
                                            <div class="form-group input-group-sm">
                                                <label for="">Unit </label>
                                                <input type="text" class="form-control" name="unit" [(ngModel)]="unit"
                                                    placeholder="Enter Unit">
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-group input-group-sm">
                                                <label for="">Range </label>
                                                <textarea class="form-control" rows="2" placeholder="enter range"
                                                    [(ngModel)]="range_from" name="range"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- text Fiels end -->

                                    <!-- numeric unbound Fiels start -->
                                    <div *ngIf="data_type=='numeric unbound';">
                                        <div class="col-12">
                                            <div class="form-group input-group-sm">
                                                <label for="">Unit </label>
                                                <input type="text" class="form-control" name="unit" [(ngModel)]="unit"
                                                    placeholder="Enter Unit">
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">Select Operation </label>
                                                    </div>
                                                    <div class="form-group input-group input-group-sm">
                                                        <select class="form-select" [(ngModel)]="opertaion"
                                                            name="opertaion">
                                                            <option value="">select operation</option>
                                                            <option value="less than equal to">less than equal to
                                                            </option>
                                                            <option value="less than">less than</option>
                                                            <option value="greater than equal to">greater than equal to
                                                            </option>
                                                            <option value="greater than">greater than</option>
                                                            <option value="equal to">equal to</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">Value </label>
                                                        <input type="number" class="form-control" name="operation_value"
                                                            [(ngModel)]="operation_value" placeholder="enter value">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- numeric unbound Fiels End -->

                                    <!-- custom Fiels start -->
                                    <div *ngIf="data_type=='custom';">
                                        <div class="col-12">
                                            <div class="row">
                                                <div class="col-12">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">Select Options </label>
                                                    </div>
                                                    <div class="form-group input-group input-group-sm">
                                                        <select class="form-select" #selectOptions>
                                                            <option value="">select options</option>
                                                            <option value="Positive">Positive</option>
                                                            <option value="Negative">Negative</option>
                                                            <option value="Absent">Absent</option>
                                                            <option value="Present">Present</option>
                                                            <option value="Reactive">Reactive</option>
                                                            <option value="Non-Reactive">Non-Reactive</option>
                                                        </select>
                                                        <button class="btn btn-secondary btn-sm"
                                                            (click)="addCustom(selectOptions.value)">Add</button>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="text-right">
                                                        <span style="cursor: pointer; font-size: 14px; color: blue;">
                                                            <i class="fa-solid fa-plus"></i> add new</span>
                                                    </div>
                                                </div>
                                                <div *ngIf="selected_options.length != 0" class="col-12 mt-2">
                                                    <table class="table table-sm table-bordered">
                                                        <tbody>
                                                            <tr>
                                                                <td *ngFor="let item of selected_options index as i">
                                                                    {{item}}
                                                                    <button type="button" class="btn-close btn-sm"
                                                                        (click)="removefromlistOfOptopns(i)"></button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col-12">
                                                    <div class="form-group input-group-sm">
                                                        <label for="">Units </label>
                                                        <input type="text" class="form-control" name="unit"
                                                            [(ngModel)]="unit" placeholder="enter value">
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="form-group input-group-sm">
                                                        <label for="exampleFormControlTextarea1"
                                                            class="form-label">Range</label>
                                                        <textarea class="form-control" rows="2"
                                                            placeholder="enter range" [(ngModel)]="range_from"
                                                            name="range"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- custom Fiels End -->
                                    <div class="form-check mt-2" *ngIf="data_type=='numeric';">
                                        <div class="row">
                                            <div class="col-6 p-0">
                                                <label class="ms-0">Apply Formula</label>
                                            </div>

                                            <div class="col-3 form-check">
                                                <input class="form-check-input" type="radio" name="CheckBox"
                                                    id="flexCheckDefault1" (click)="applyFormulaYes()"
                                                    [checked]="apply_formula">
                                                <label class="form-check-label" for="flexCheckDefault1">
                                                    Yes
                                                </label>
                                            </div>
                                            <div class="col-3 form-check">
                                                <input class="form-check-input" type="radio" name="CheckBox"
                                                    id="flexCheckDefault2" (click)="applyFormulaNo()"
                                                    [checked]="!apply_formula">
                                                <label class="form-check-label" for="flexCheckDefault2">
                                                    No
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div *ngIf="apply_formula==true;">
                                        <div class="col-12 mt-2">
                                            <div class="form-group input-group-sm">
                                                <label for="">Select Field </label>
                                            </div>
                                            <div class="form-group input-group input-group-sm">
                                                <select class="form-select" #selectedField [disabled]="inputButtonFlag">
                                                    <option value="">select</option>
                                                    <option *ngFor="let item of field_name_list" value="{{item}}">
                                                        {{item}}
                                                    </option>
                                                </select>
                                                <button class="btn btn-secondary btn-sm" [disabled]="inputButtonFlag"
                                                    (click)="addFieldInFormula(selectedField.value)">Add</button>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-2 d-flex justify-content-between">
                                            <button class="formula-button" [disabled]="mathButtonFlag"
                                                (click)="addButtonInFormula()" data-bs-toggle="tooltip"
                                                data-bs-placement="bottom" title="Addition">+</button>
                                            <button class="formula-button" [disabled]="mathButtonFlag"
                                                (click)="minusButtonInFormula()" data-bs-toggle="tooltip"
                                                data-bs-placement="bottom" title="Substract">-</button>
                                            <button class="formula-button" [disabled]="mathButtonFlag"
                                                (click)="multilyButtonInFormula()" data-bs-toggle="tooltip"
                                                data-bs-placement="bottom" title="multiply">*</button>
                                            <button class="formula-button" [disabled]="mathButtonFlag"
                                                (click)="divideButtonInFormula()" data-bs-toggle="tooltip"
                                                data-bs-placement="bottom" title="division">/</button>
                                            <button class="formula-button" (click)="openBracketButtonInFormula()"
                                                data-bs-toggle="tooltip" data-bs-placement="bottom"
                                                title="Open Bracket">(</button>
                                            <button class="formula-button" (click)="closeBracketButtonInFormula()"
                                                data-bs-toggle="tooltip" data-bs-placement="bottom"
                                                title="Close Bracket">)</button>
                                            <div class="form-group input-group input-group-sm">
                                                <input type="number" class="form-control" #formulaNumber
                                                    placeholder="Number" [disabled]="inputButtonFlag">
                                                <button class="btn btn-secondary btn-sm"
                                                    (click)="addFieldInFormula(formulaNumber.value)"
                                                    [disabled]="inputButtonFlag">Add</button>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-4">
                                            <div class="form-group input-group-sm d-flex justify-content-between">
                                                <label for="exampleFormControlTextarea1" class="form-label">Formula
                                                    *</label>
                                                <div>
                                                    <button class="btn btn-secondary btn-sm "
                                                        (click)="validateFormula()">Validate</button>
                                                    <button class="btn btn-secondary btn-sm ms-2"
                                                        (click)="removeLastElement()" title="Backspace"><i
                                                            class="fa-solid fa-arrow-left"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-2">
                                            <div class="form-group input-group-sm">
                                                <textarea class="form-control" rows="2" placeholder="Add Formula"
                                                    [(ngModel)]="formula" name="formula" disabled></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 mt-2">
                                        <div class="row px-2">
                                            <button *ngIf="!modifyRow" class="btn btn-success btn-sm"
                                                (click)="addRowInTestTable()" [disabled]="!fieldform.valid"><i
                                                    class="fa-solid fa-plus"></i> add</button>
                                            <button *ngIf="modifyRow" class="btn btn-success btn-sm"
                                                (click)="modifyRowInTestTable()" [disabled]="!fieldform.valid">
                                                Modify</button>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <!-- Title Field start -->
                            <form #titlefieldform="ngForm">
                                <div *ngIf="field_type=='Title Field' && testMaster.testType=='Table'">
                                    <div class="col-12 mt-2">
                                        <div class="form-group input-group-sm">
                                            <label for="">Title Field *</label>
                                            <input type="text" class="form-control" name="title_field"
                                                [(ngModel)]="title_field" placeholder="Enter Title Field" required>
                                        </div>
                                    </div>
                                    <div class="col-12 my-4">
                                        <div class="row px-2">
                                            <button *ngIf="!modifyRow" class="btn btn-success btn-sm"
                                                (click)="addRowInTestTable()" [disabled]="!titlefieldform.valid"><i
                                                    class="fa-solid fa-plus"></i> add</button>
                                            <button *ngIf="modifyRow" class="btn btn-success btn-sm"
                                                (click)="modifyRowInTestTable()"
                                                [disabled]="!titlefieldform.valid">Modify</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Title Field end -->
                            </form>
                        </div>
                        <div class="col-8">
                            <div *ngIf="testMaster.testType=='Text'" style="height: 54vh;">
                                <angular-editor [placeholder]="'Enter text here...'" [(ngModel)]="textContent"
                                    [config]="editorConfig"></angular-editor>
                                <iframe frameborder="0">
                                    <div id="pdfContent" class="textContentDiv" style="width: 570px;" #pdfContent>
                                        <div class="textContentDiv" [innerHTML]="textContent"></div>
                                    </div>
                                </iframe>
                            </div>
                            <div *ngIf="field_type!='Text Editor' && testMaster.testType=='Table'"
                                style="height: 54vh;  width: 100%;">
                                <table class="table table-hover table-bordered">
                                    <thead class="table-light" style="position: sticky; top: 0; z-index: 1;">
                                        <tr>
                                            <th scope="col">Select</th>
                                            <th scope="col">#</th>
                                            <th scope="col">+</th>
                                            <th scope="col">Field Name</th>
                                            <th scope="col">Sub Field</th>
                                            <th scope="col">Data Type</th>
                                            <th scope="col">Unit</th>
                                            <th scope="col">Range</th>
                                            <th scope="col">Formula</th>
                                            <th scope="col">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody cdkDropList (cdkDropListDropped)="drop($event)">
                                        <tr cdkDrag cdkDragLockAxis="y"
                                            *ngFor="let item of testMaster.testTableDataDTOList index as i">
                                            <th><input class="form-check-input" type="checkbox"
                                                    name="{{item.field_name}}" id="{{item.field_name}}"
                                                    [checked]="selected === i"
                                                    (change)="onClickTestField($event,item,i)"></th>
                                            <th>{{i+1}}</th>
                                            <th (click)="openSUbFieldTable(i)" style="cursor: pointer;"
                                                data-bs-toggle="tooltip" data-bs-placement="bottom">
                                                <span *ngIf="isRowClickable(i)">
                                                    <span *ngIf="expanded[i]" title="Collapse subfield Table">-</span>
                                                    <span *ngIf="!expanded[i]" title="Expand subfield Table">+</span>
                                                </span>
                                            </th>
                                            <td cdkDragHandle style="cursor: pointer;">{{item.field_name}}</td>
                                            <td>{{item.sub_field}}</td>
                                            <td>{{item.data_type}}</td>
                                            <td>{{item.unit}}</td>
                                            <td>{{item.range_from}}-{{item.range_to}}</td>
                                            <th><input *ngIf="item.apply_formula == true" class="form-check-input"
                                                    type="checkbox" name="check+i" id="check+i" checked disabled>
                                                <input *ngIf="item.apply_formula == false" class="form-check-input"
                                                    type="checkbox" name="check+i" id="check+i" disabled>
                                            </th>
                                            <td><Button class="btn btn-danger btn-sm"
                                                    (click)="removeFormtestContentList(i,item)"><i
                                                        class="fa-solid fa-trash-can" data-bs-toggle="tooltip"
                                                        data-bs-placement="bottom" title="delete row"></i></Button></td>
                                        </tr>
                                    </tbody>
                                    <br>
                                    <tbody *ngIf="subfieldTableFlag" cdkDropList
                                        (cdkDropListDropped)="subListDrop($event)" class="table-secondary">
                                        <tr cdkDrag cdkDragLockAxis="y"
                                            *ngFor="let item of subFieldDataList index as i">
                                            <th><input class="form-check-input" type="checkbox"
                                                    name="{{item.sub_field}}" id="{{item.sub_field}}"
                                                    [checked]="subFieldSelected === i"
                                                    (change)="onClickTestSubField($event,item,i)"></th>
                                            <th>{{i+1}}</th>
                                            <th></th>
                                            <td cdkDragHandle style="cursor: pointer;">{{item.field_name}}</td>
                                            <td>{{item.sub_field}}</td>
                                            <td>{{item.data_type}}</td>
                                            <td>{{item.unit}}</td>
                                            <td>{{item.range_from}}-{{item.range_to}}</td>
                                            <th><input *ngIf="item.apply_formula == 'Y'" class="form-check-input"
                                                    type="checkbox" name="check+i" id="check+i" checked disabled>
                                                <input *ngIf="item.apply_formula == 'N'" class="form-check-input"
                                                    type="checkbox" name="check+i" id="check+i" disabled>
                                            </th>
                                            <td><Button class="btn btn-danger btn-sm"
                                                    (click)="removeFormSubFielsLlist(i,item)"><i
                                                        class="fa-solid fa-trash-can" data-bs-toggle="tooltip"
                                                        data-bs-placement="bottom" title="delete row"></i></Button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-secondary btn-sm" [disabled]="!f.valid">Reset Report</button>
                <button type="button" class="btn btn-secondary btn-sm" data-bs-target="#viewReportPdf"
                    data-bs-toggle="modal" data-bs-dismiss="modal" (click)=" makePdf()" [disabled]="!f.valid">View
                    Report</button>
                <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#saveModal"
                    (click)="onProceedClick()" [disabled]="!f.valid">{{ModalButtonName}}</button>

            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="saveModal" tabindex="-1" aria-labelledby="saveModalLabel" aria-hidden="true"
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="saveModalLabel"> Alert </h5>
                <button type="button" #saveModal aria-label="Close" data-bs-dismiss="modal" aria-label="Close"
                    style="border: none; background-color: white;"></button>
                <button type="button" class="btn-close" aria-label="Close" data-bs-toggle="modal"
                    data-bs-target="#addTestModal"></button>
            </div>
            <div class="modal-body ms-4">
                {{proceedModalMessage}}
            </div>
            <div class="modal-footer py-2">
                <button type="button" class="btn btn-sm btn-secondary" data-bs-toggle="modal"
                    data-bs-target="#addTestModal">back</button>
                <button type="button" *ngIf="addmodal" class="btn btn-sm btn-success" (click)="addNewTest()">Add
                    Test</button>
                <button type="button" *ngIf="modifyModal" class="btn btn-sm btn-success" (click)="modifyTest()">Save
                    Changes</button>
            </div>
        </div>
    </div>
</div>




<div class="modal fade modal-dialog-scrollable" id="OptionModal" tabindex="-1" data-bs-backdrop="static"
    data-bs-keyboard="false" aria-labelledby="OptionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="OptionModalLabel">Alert</h5>
                <button type="button" class="btn-close" #OptionModal data-bs-toggle="modal" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body ms-4">
                Do you want delete this test !
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-dismiss="modal">
                    Cancel </button>
                <button type="button" class="btn btn-danger btn-sm" (click)="deleteTest()"> Delete </button>
            </div>
        </div>
    </div>
</div>



<!-- Report in PDF Model -->
<div class="modal fade" id="viewReportPdf" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
    aria-labelledby="viewReportPdfLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewReportPdfLabel">View Report</h5>
                <button type="button" class="btn-close" data-bs-toggle="modal" data-bs-target="#addTestModal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body p-0" style="height: 70vh;">
                <div class="row justify-content-center">
                    <embed [src]="pdfurl" style="height: 70vh; width: 150vh;" />
                </div>
                <!-- <iframe frameborder="0" id="pdfHeaderContent" class="" style="width: 570px;" #pdfHeaderContent >
                <div class="row">
                        <div class="col-2">
                            <img src="assets/Microscop.png" alt="Microscop" height="70" width="">
                        </div>
                        <div class="col-8">
                            <h5>Ganesh Labarotory</h5>
                        </div>
                        <div class="col-2">

                        </div>
                </div>
            </iframe> -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal"
                    data-bs-target="#addTestModal">Back</button>
                <button type="button" class="btn btn-primary btn-sm" (click)="makePdf()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="viewReportPdf1" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
    aria-labelledby="viewReportPdfLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewReportPdfLabel">View Report</h5>
                <button type="button" class="btn-close" data-bs-toggle="modal" data-bs-target="#viewTestModal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body p-0" style="height: 70vh;">
                <div class="row justify-content-center">
                    <embed [src]="pdfurl" style="height: 70vh; width: 150vh;" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal"
                    data-bs-target="#viewTestModal">Back</button>
                <button type="button" class="btn btn-primary btn-sm" (click)="makePdf()">Print Report</button>
            </div>
        </div>
    </div>
</div>